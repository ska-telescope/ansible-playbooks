- name: Download helm install script
  get_url:
    url: https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
    dest: /tmp/get_helm.sh
    mode: '0700'

- name: Add /usr/local/bin to system path
  copy:
    dest: 
  shell: export PATH=/usr/local/bin:$PATH

  # Also make /usr/local/bin available for future sessions
- name: Add /usr/local/bin to system path in profile
  copy: 
    content: pathmunge /usr/local/bin
    dest: /etc/profile.d/helm_path.sh
    force: no
  become: yes
  when: ansible_distribution == 'CentOS'

- name: Make helm_path file executable
  file:
    path: /etc/profile.d/helm_path.sh
    mode: +x
  become: yes

- name: Install Helm
  shell: "/tmp/get_helm.sh -v {{ helm_version }}"
  args:
    executable: /bin/bash

- name: Tidy up Helm script
  file:
    path: '/tmp/get_helm.sh'
    state: absent

- name: Add stable helm repo
  shell: |
    helm repo add stable {{helm_stable_repo_url}}
    helm repo update;